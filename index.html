<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Piglet Football</title>

    <!-- 1. –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç Telegram -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- 2. –ü–æ–ª–∏—Ç–∏–∫–∞ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (CSP) -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval' 'unsafe-inline' https://telegram.org; connect-src 'self' https://zenit-kinopoick.site;">

    <!-- 3. –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏ —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <style>
      /* –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –∏ —Ñ–∏–∫—Å—ã –¥–ª—è iOS */
      * {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }

      html, body { 
        padding: 0; 
        margin: 0; 
        overflow: hidden; 
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        /* –§–∏–∫—Å—ã –≤—ã—Å–æ—Ç—ã –¥–ª—è iOS */
        height: 100%;
        min-height: 100%;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        min-height: -webkit-fill-available;
        /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ safe area –¥–ª—è iPhone X+ */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }
      
      #unity-canvas { 
        width: 100vw; 
        height: 100vh; 
        height: calc(var(--vh, 1vh) * 100);
        height: -webkit-fill-available;
        position: fixed; 
        top: 0; 
        left: 0; 
        display: none; /* –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç */
      }

      /* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ */
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        height: -webkit-fill-available;
        min-height: 100vh;
        min-height: calc(var(--vh, 1vh) * 100);
        min-height: -webkit-fill-available;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        color: white;
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—ã –¥–ª—è iOS */
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: none;
      }

      /* –õ–æ–≥–æ—Ç–∏–ø/–Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã */
      .game-title {
        font-size: 48px;
        font-weight: bold;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        animation: pulse 2s ease-in-out infinite alternate;
        text-align: center;
        padding: 0 20px;
      }

      @keyframes pulse {
        from { opacity: 0.8; }
        to { opacity: 1; }
      }

      /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª–æ—Å—ã –∑–∞–≥—Ä—É–∑–∫–∏ */
      .progress-container {
        width: min(400px, 80vw);
        height: 20px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }

      /* –ü–æ–ª–æ—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
      .progress-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #00f260, #0575e6);
        border-radius: 10px;
        transition: width 0.3s ease;
        box-shadow: 0 0 20px rgba(5, 117, 230, 0.6);
      }

      /* –¢–µ–∫—Å—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
      .progress-text {
        font-size: 18px;
        margin-bottom: 10px;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        text-align: center;
        padding: 0 20px;
      }

      /* –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ */
      .progress-percent {
        font-size: 24px;
        font-weight: bold;
        margin-top: 10px;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      }

      /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ—á–µ–∫ */
      .loading-dots {
        animation: loadingDots 1.5s infinite;
      }

      @keyframes loadingDots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60% { content: '...'; }
        90%, 100% { content: ''; }
      }

      /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
      .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255,255,255,0.3);
        border-top: 4px solid #00f260;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-top: 30px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
      @media (max-width: 480px) {
        .game-title {
          font-size: min(36px, 8vw);
          margin-bottom: 20px;
        }
        .progress-container {
          width: 85vw;
        }
        .progress-text {
          font-size: 16px;
        }
        .progress-percent {
          font-size: 20px;
        }
      }

      /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è iOS */
      @supports (-webkit-touch-callout: none) {
        html, body {
          height: -webkit-fill-available;
          height: calc(var(--vh, 1vh) * 100);
        }
        #loading-screen {
          height: -webkit-fill-available;
          height: calc(var(--vh, 1vh) * 100);
        }
        #unity-canvas {
          height: -webkit-fill-available;
          height: calc(var(--vh, 1vh) * 100);
        }
      }
    </style>
  </head>
  <body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-screen">
      <div class="game-title">üê∑ Piglet Football</div>
      <div class="progress-text">–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É<span class="loading-dots"></span></div>
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="progress-percent" id="progress-percent">0%</div>
      <div class="loading-spinner"></div>
    </div>

    <!-- Canvas –¥–ª—è Unity (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
    <canvas id="unity-canvas" tabindex="-1"></canvas>
    
    <!-- –°–∫—Ä–∏–ø—Ç-–∑–∞–≥—Ä—É–∑—á–∏–∫ Unity -->
    <script src="Build/myuntggame.loader.js"></script>

    <!-- –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Unity —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º -->
    <script>
      // –§–∏–∫—Å –≤—ã—Å–æ—Ç—ã –¥–ª—è iOS Safari
      function setViewportHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è iOS
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.style.minHeight = window.innerHeight + 'px';
        }
      }

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
      window.addEventListener('load', setViewportHeight);
      window.addEventListener('resize', setViewportHeight);
      window.addEventListener('orientationchange', () => {
        setTimeout(setViewportHeight, 100);
      });

      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ iOS
      document.addEventListener('touchmove', function (event) {
        if (event.scale !== 1) { event.preventDefault(); }
      }, { passive: false });

      let lastTouchEnd = 0;
      document.addEventListener('touchend', function (event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);

      // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      const progressBar = document.getElementById('progress-bar');
      const progressPercent = document.getElementById('progress-percent');
      const progressText = document.querySelector('.progress-text');
      const loadingScreen = document.getElementById('loading-screen');
      const unityCanvas = document.getElementById('unity-canvas');

      // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      function updateProgress(progress, message = '–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É') {
        const percent = Math.round(progress * 100);
        progressBar.style.width = percent + '%';
        progressPercent.textContent = percent + '%';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —ç—Ç–∞–ø–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        if (progress < 0.3) {
          progressText.innerHTML = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤<span class="loading-dots"></span>';
        } else if (progress < 0.7) {
          progressText.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤<span class="loading-dots"></span>';
        } else if (progress < 0.95) {
          progressText.innerHTML = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤–∏–∂–∫–∞<span class="loading-dots"></span>';
        } else {
          progressText.innerHTML = '–ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É<span class="loading-dots"></span>';
        }
      }

      // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏
      function hideLoadingScreen() {
        setTimeout(() => {
          progressText.innerHTML = '–ì–æ—Ç–æ–≤–æ! üéÆ';
          progressPercent.textContent = '100%';
          
          setTimeout(() => {
            loadingScreen.style.opacity = '0';
            loadingScreen.style.transition = 'opacity 0.5s ease';
            unityCanvas.style.display = 'block';
            unityCanvas.style.opacity = '0';
            unityCanvas.style.transition = 'opacity 0.5s ease';
            
            setTimeout(() => {
              unityCanvas.style.opacity = '1';
              setTimeout(() => {
                loadingScreen.style.display = 'none';
              }, 500);
            }, 100);
          }, 500);
        }, 200);
      }

      // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Unity —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/myuntggame.data",
        frameworkUrl: "Build/myuntggame.framework.js",
        codeUrl: "Build/myuntggame.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Piglet Football",
        productVersion: "0.1.0",
      }, (progress) => {
        // Callback –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        updateProgress(progress);
      }).then((instance) => {
        // Unity —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω
        console.log("Unity instance is ready and saved to window.unityInstance.");
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Unity –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
        window.unityInstance = instance;
        
        // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
        hideLoadingScreen();

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ C# —á—Ç–æ –≤—Å—ë –≥–æ—Ç–æ–≤–æ
        console.log("Sending OnUnityReady command to Unity...");
        setTimeout(() => {
          instance.SendMessage('ServerManager', 'OnUnityReady');
        }, 1000); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏

      }).catch((error) => {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
        console.error("Failed to load Unity instance:", error);
        progressText.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
        progressBar.style.background = 'linear-gradient(90deg, #ff6b6b, #ee5a52)';
        progressPercent.textContent = '–û—à–∏–±–∫–∞!';
      });
    </script>
  </body>
</html>