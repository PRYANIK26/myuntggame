<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Piglet Football</title>

    <!-- 1. Подключаем скрипт Telegram -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- 2. Политика Безопасности (CSP) - КЛЮЧЕВОЕ ИЗМЕНЕНИЕ -->
    <!-- Разрешает запросы (connect-src) на ваш НОВЫЙ HTTPS сервер -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval' 'unsafe-inline' https://telegram.org; connect-src 'self' https://zenit-kinopoick.site;">

    <!-- 3. Стили для полноэкранного режима -->
    <style>
      html, body { padding: 0; margin: 0; overflow: hidden; }
      #unity-canvas { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; }
    </style>
  </head>
  <body>
    <!-- 4. Холст для Unity (без лишних атрибутов) -->
    <canvas id="unity-canvas" tabindex="-1"></canvas>
    
    <!-- 5. Скрипт-загрузчик Unity (используем ВАШЕ имя файла) -->
    <script src="Build/myuntggame.loader.js"></script>

    <!-- 6. Скрипт инициализации Unity -->
    <script>
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/myuntggame.data",
        frameworkUrl: "Build/myuntggame.framework.js",
        codeUrl: "Build/myuntggame.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Piglet Football",
        productVersion: "0.1.0",
      }).then((instance) => {
        // --- ЭТО САМЫЙ ВАЖНЫЙ БЛОК ---

        // 1. Сохраняем экземпляр Unity в глобальную переменную.
        //    Это нужно, чтобы ваш .jslib файл мог найти его и отправить сообщение обратно в C#.
        window.unityInstance = instance;
        console.log("Unity instance is ready and saved to window.unityInstance.");

        // 2. Отправляем команду в C# (в скрипт TelegramInitializer), что всё готово.
        //    Это запускает процесс получения данных пользователя.
        console.log("Sending OnUnityReady command to Unity...");
        instance.SendMessage('ServerManager', 'OnUnityReady');

      }).catch((error) => {
        // Выводим ошибку в консоль, если Unity не смог загрузиться
        console.error("Failed to load Unity instance:", error);
      });
    </script>
  </body>
</html>